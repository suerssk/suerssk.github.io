<!DOCTYPE HTML>
<html lang="en">

<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="Suressk.com">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="http://yoursite.com">
    <!--SEO-->

<meta name="keywords" content="" />


<meta name="description" content="fs 文件流 &amp;&amp; net 模块 &amp;&amp; http 模块[toc]
流Node.js  -&gt;  stream 模块
指数据的流动，数据从一个地方缓缓地流到另一..." />


<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->

<title>
    
    NodeJs初识之二 |
    
    Suressk.com
</title>

<link rel="alternate" href="/atom.xml" title="Suressk.com" type="application/atom+xml">


<link rel="icon" href="/favicon.ico">

    


<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7.css">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.7.0.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash.css">

    
<div class="hide">
    <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script>
</div>




    

<meta name="generator" content="Hexo 4.2.1"></head>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->
<body>
    <header class="main-header"  style="background-image:url(
    http://snippet.shenliyang.com/img/banner.jpg)"
         >
            <div class="main-header-box">
                <a class="header-avatar" href="/" title='GravAvatar'>
                    <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
                </a>
                <div class="branding">
                    <!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
                    
                            <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
                                
                </div>
            </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                        <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://yoursite.com">
                        Suressk.com</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                        <li role="presentation" class="text-center">
                            <a href="/"><i class="fa "></i>
                                Home</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/前端/"><i class="fa "></i>
                                前端</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/后端/"><i class="fa "></i>
                                后端</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/工具/"><i class="fa "></i>
                                工具</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/archives/"><i class="fa "></i>
                                时间轴</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="NodeJs初识之二">
            
            NodeJs初识之二
            
        </h1>
        <div class="post-meta">
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
        </span>
    </span>
    
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">
            2020/05/22</span>
    </span>
    
    
</div>
        
        
    </div>
    
    <div class="post-body post-content">
        <h1 id="fs-文件流-amp-amp-net-模块-amp-amp-http-模块"><a href="#fs-文件流-amp-amp-net-模块-amp-amp-http-模块" class="headerlink" title="fs 文件流 &amp;&amp; net 模块 &amp;&amp; http 模块"></a>fs 文件流 &amp;&amp; net 模块 &amp;&amp; http 模块</h1><p>[toc]</p>
<h2 id="流"><a href="#流" class="headerlink" title="流"></a>流</h2><p>Node.js  -&gt;  stream 模块</p>
<p>指数据的流动，数据从一个地方缓缓地流到另一个地方。</p>
<p>流是有方向的</p>
<p>可读流: Readable    数据  源头 → 内存<br>可写流: Writable    数据  内存 → 源头<br>双工流: Duplex      数据  源头 ←→ 内存 (将可读、可写进行封装而成的)</p>
<h3 id="文件流"><a href="#文件流" class="headerlink" title="文件流"></a>文件流</h3><p>是内存数据和磁盘文件数据之间的流动</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; Readable, Writable &#125; = <span class="built_in">require</span>(<span class="string">'stream'</span>);</span><br></pre></td></tr></table></figure>

<p>文件流的创建:</p>
<ol>
<li><p><code>fs.createReadStream(path [, options])</code>  继承自 stream 模块</p>
<ul>
<li><p><code>path</code>: 路径</p>
</li>
<li><p><code>options</code>: 配置<br>  {</p>
<pre><code>encoding(编码方式),
start(起始字节),
end(结束字节),
highWaterMark: 每次读取量(默认64字节 -&gt; `64*1024`),
autoClose: true // 默认读完文件后自动关闭</code></pre><p>  }</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件可读流</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> filename = path.resolve(__dirname, <span class="string">"./srcDir.json"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回一个 Readable的子类 ReadStream</span></span><br><span class="line"><span class="keyword">const</span> rs = fs.createReadStream(filename, &#123;</span><br><span class="line">    encoding: <span class="string">"utf-8"</span>, <span class="comment">// 默认 null -&gt; buffer 格式</span></span><br><span class="line">    highWaterMark: <span class="number">1</span>    <span class="comment">// 未指定encoding时，默认64*1024;</span></span><br><span class="line">    <span class="comment">// 若 encoding 有值(非 null)，此数量表示读取的字符数</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 事件 open / close / error / end / data ...</span></span><br><span class="line">rs.on(<span class="string">'open'</span>, () =&gt; <span class="built_in">console</span>.log(<span class="string">"文件被打开了"</span>));</span><br><span class="line"><span class="comment">// 文件关闭，可能会自动关闭(默认读完文件就自动关闭); 或者手动调用 rs.close() 方法关闭文件   (此时，只是打开文件而没有读文件)</span></span><br><span class="line">rs.on(<span class="string">'close'</span>, () =&gt; <span class="built_in">console</span>.log(<span class="string">"文件关闭了"</span>));</span><br><span class="line"><span class="comment">// rs.close(); // 手动关闭文件</span></span><br><span class="line">rs.on(<span class="string">'error'</span>, () =&gt; <span class="built_in">console</span>.log(<span class="string">"出错了"</span>)); <span class="comment">// 例如去读不存在的文件就会触发</span></span><br><span class="line"></span><br><span class="line">rs.on(<span class="string">'data'</span>, chunk =&gt; &#123;<span class="built_in">console</span>.log(<span class="string">"读到了一部分数据："</span> + chunk)&#125;);  <span class="comment">// chunk 表示读到的一部分数据(每读一部分就触发一次)</span></span><br><span class="line">rs.on(<span class="string">'end'</span>, () =&gt; <span class="built_in">console</span>.log(<span class="string">"全部数据读取完毕"</span>)); <span class="comment">// 数据读取完毕时触发(在关闭文件前触发)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 暂停读取，会触发 pause 事件</span></span><br><span class="line">rs.pause();     <span class="comment">// rs.on('pause', () =&gt; console.log("暂停了"));</span></span><br><span class="line"><span class="comment">// 3. 恢复读取，会触发 resume 事件</span></span><br><span class="line">rs.resume();    <span class="comment">// rs.on('resume', () =&gt; console.log("恢复了"));</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>fs.createWriteStream(path [, options])</code>  创建一个写入流</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件可读流</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> filename = path.resolve(__dirname, <span class="string">"./writeFile.json"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回一个 Writable的子类 WriteStream</span></span><br><span class="line"><span class="keyword">const</span> ws = fs.createWriteStream(filename, &#123;</span><br><span class="line">    flags: <span class="string">'a'</span>,  <span class="comment">// 操作文件的方式 -&gt; w: 覆盖 ; a: 追加 / 其他方式</span></span><br><span class="line">    encoding: <span class="string">"utf-8"</span>,</span><br><span class="line">    highWaterMark: <span class="number">2</span>  <span class="comment">// 与上面的不同，这是每次最多写入的字节数(若是汉字，3个字节，就超过了这里最多写入限制 两个字节 了)(默认是 16kb)</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 事件 open / close / error...</span></span><br><span class="line">ws.on(<span class="string">'open'</span>, () =&gt; <span class="built_in">console</span>.log(<span class="string">"文件被打开了"</span>));</span><br><span class="line"><span class="comment">// 默认写操作完成就自动关闭</span></span><br><span class="line">ws.on(<span class="string">'close'</span>, () =&gt; <span class="built_in">console</span>.log(<span class="string">"文件关闭了"</span>));</span><br><span class="line"><span class="comment">// rs.close(); // 手动关闭文件</span></span><br><span class="line">ws.on(<span class="string">'error'</span>, () =&gt; <span class="built_in">console</span>.log(<span class="string">"出错了"</span>)); <span class="comment">// 写入错误会触发</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 写入方法</span></span><br><span class="line"><span class="keyword">const</span> flag = ws.write(data); <span class="comment">// =&gt; 写入一组数据</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> data 可以是字符串或 Buffer</span></span><br><span class="line"><span class="comment"> 返回一个 Boolean 值</span></span><br><span class="line"><span class="comment">    =&gt;  true 表示写入通道未填满，可以继续写入，无需排队</span></span><br><span class="line"><span class="comment">    =&gt;  false 表示写入通道已填满，接下来的数据将进入写入队列(内存中)，等待写入</span></span><br><span class="line"><span class="comment"> 因而要注意，在内存中写入队列占据内存资源(背压问题)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> 当写入队列清空时，会触发 drain 事件</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 背压问题解决方案: 利用写入操作的返回值 flag ; 如下:</span></span><br><span class="line">(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> num = <span class="number">1024</span>**<span class="number">2</span> * <span class="number">10</span>, <span class="comment">/** 写入10 MB 文件*/</span></span><br><span class="line">            flag = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; num &amp;&amp; flag)&#123;</span><br><span class="line">            ws.write(<span class="string">'a'</span>);</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    write();</span><br><span class="line">    ws.on(<span class="string">'drain'</span>, () =&gt; &#123;</span><br><span class="line">        write();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 结束写入，将自动关闭文件(需配合 autoClose 配置项)</span></span><br><span class="line"><span class="comment">// data 是可选的，表示关闭前的最后一次写入数据</span></span><br><span class="line">ws.end([data]);</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>练习: 读出文件 -&gt; copy 写入新文件（借用上面写入的 10MB 的文件）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>method1</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">method1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">from</span> = path.resolve(__dirname, <span class="string">"./test1.txt"</span>);</span><br><span class="line">    <span class="keyword">const</span> to = path.resolve(__dirname, <span class="string">"./test2.txt"</span>);</span><br><span class="line">    <span class="built_in">console</span>.time(<span class="string">'method 1'</span>);</span><br><span class="line">    <span class="keyword">const</span> content = <span class="keyword">await</span> fs.promises.readFile(<span class="keyword">from</span>, <span class="string">"utf-8"</span>);</span><br><span class="line">    <span class="keyword">await</span> fs.promises.writeFile(to, content);</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">'method 1'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"复制完成"</span>);</span><br><span class="line">&#125;</span><br><span class="line">method1();</span><br></pre></td></tr></table></figure>

<p>  <img src="./assets/copy_1.jpg" alt="Running time"></p>
</li>
<li><p>method2</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">method2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">from</span> = path.resolve(__dirname, <span class="string">"./test1.txt"</span>);</span><br><span class="line">    <span class="keyword">const</span> to = path.resolve(__dirname, <span class="string">"./test2.txt"</span>);</span><br><span class="line">    <span class="built_in">console</span>.time(<span class="string">'method 2'</span>);</span><br><span class="line">    <span class="keyword">const</span> rs = fs.createReadStream(<span class="keyword">from</span>, &#123;</span><br><span class="line">        encoding: <span class="string">'utf-8'</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> ws = fs.createWriteStream(to, &#123;</span><br><span class="line">        encoding: <span class="string">'utf-8'</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 读取数据</span></span><br><span class="line">    rs.on(<span class="string">'data'</span>, chunk =&gt; &#123;</span><br><span class="line">        <span class="comment">// 写数据</span></span><br><span class="line">        <span class="keyword">let</span> flag = ws.write(chunk);</span><br><span class="line">        <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">            <span class="comment">// 排队 -&gt; 暂停读取</span></span><br><span class="line">            rs.pause();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 队列清空 -&gt; 继续读取</span></span><br><span class="line">    ws.on(<span class="string">'drain'</span>, () =&gt; &#123;</span><br><span class="line">        rs.resume();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 文件读取完毕</span></span><br><span class="line">    rs.on(<span class="string">'close'</span>, () =&gt; &#123;</span><br><span class="line">        ws.end();</span><br><span class="line">        <span class="built_in">console</span>.timeEnd(<span class="string">'method 2'</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"复制完成"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">method2();</span><br></pre></td></tr></table></figure>

<p>  <img src="./assets/copy_2.jpg" alt="Running time"></p>
<p>  从上面两张图的对比，我们可以看到，方式2从时间上来看，削减了一半至少(还与 cpu ，磁盘(机械 / 固态)有一些关系(可能不同的机器上的运行时间不会完全一样))；<br>  更重要的一点是，方式2 比 方式1 更节约内存的使用；方式1 是将文件内容一股脑读到内存再去写（如果文件过大，内存压力就太大了）；而 方式2 就是读一点写一点啦~</p>
</li>
<li><p>方式2 的简单方法</p>
<p>  <code>rs.pipe()</code>  会将可读流串联到可写流<br>  简化代码如下:</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">method2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">from</span> = path.resolve(__dirname, <span class="string">"./test1.txt"</span>);</span><br><span class="line">    <span class="keyword">const</span> to = path.resolve(__dirname, <span class="string">"./test2.txt"</span>);</span><br><span class="line">    <span class="built_in">console</span>.time(<span class="string">'method 2'</span>);</span><br><span class="line">    <span class="keyword">const</span> rs = fs.createReadStream(<span class="keyword">from</span>, &#123;</span><br><span class="line">        encoding: <span class="string">'utf-8'</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> ws = fs.createWriteStream(to, &#123;</span><br><span class="line">        encoding: <span class="string">'utf-8'</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    rs.pipe(ws);    <span class="comment">// 管道串联</span></span><br><span class="line">    rs.on(<span class="string">'close'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.timeEnd(<span class="string">'method 2'</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"复制完成"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">method2();</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="net-模块"><a href="#net-模块" class="headerlink" title="net 模块"></a>net 模块</h2><ol>
<li><p>回顾 HTTP 请求</p>
<ul>
<li>普通模式：<br>  三次握手 -&gt; 建立连接 – 请求 – 响应 -&gt; 四次挥手</li>
<li>长连接模式：<br>  请求头 &amp;&amp; 响应头中  –&gt;  <code>Connection: keep-alive</code><br>  三次握手 -&gt; 建立长连接 - 各种数据传输 -&gt; 四次挥手</li>
</ul>
</li>
<li><p>net 模块的工作</p>
<p> net 是一个通信模块，利用它可以实现进程间的通信(IPC) / 网络通信 (TCP/IP) √</p>
</li>
<li><p>创建客户端</p>
<p> socket 是一个特殊的文件，在 node 中表现为一个双工流; 也即上面提到的 Duplex 流，既可读又可写</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">"net"</span>);</span><br><span class="line"><span class="keyword">let</span> resieve = <span class="literal">null</span>; <span class="comment">// 存储响应内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回 socket； 内部自动完成连接</span></span><br><span class="line"><span class="keyword">const</span> socket = net.createConnection(&#123;</span><br><span class="line">    host: <span class="string">'baidu.com'</span>,</span><br><span class="line">    port: <span class="number">80</span></span><br><span class="line">&#125;, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"连接成功..."</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseResponse</span>(<span class="params">response</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> index = response.indexOf(<span class="string">"\r\n\r\n"</span>),</span><br><span class="line">        head = response.substring(<span class="number">0</span>, index),</span><br><span class="line">        body = response.trimStart().substring(index),</span><br><span class="line">        headerParts = head.split(<span class="string">'\r\n'</span>),</span><br><span class="line">        headerArr = headerParts.slice(<span class="number">1</span>).map(<span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> str.split(<span class="string">":"</span>);</span><br><span class="line">        &#125;),</span><br><span class="line">        header = headerArr.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">            a[b[<span class="number">0</span>]] = b[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        &#125;, &#123;&#125;);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        header,</span><br><span class="line">        body: body.trimStart()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isOver</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 消息体总字节数</span></span><br><span class="line">    <span class="keyword">const</span> contentLength = resieve.header[<span class="string">"Content-Length"</span>];</span><br><span class="line">    <span class="keyword">const</span> curLength = Buffer.from(resieve.body, <span class="string">"utf-8"</span>).byteLength;</span><br><span class="line">    <span class="keyword">return</span> curLength &gt;= contentLength;</span><br><span class="line">&#125;</span><br><span class="line">socket.on(<span class="string">'data'</span>, chunk =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> response = chunk.toString(<span class="string">'utf-8'</span>);</span><br><span class="line">    <span class="keyword">if</span> (!resieve) &#123;</span><br><span class="line">        resieve = parseResponse(response);</span><br><span class="line">        <span class="comment">// 第一次传输就结束</span></span><br><span class="line">        <span class="keyword">if</span> (isOver()) &#123;</span><br><span class="line">            socket.end(); <span class="comment">// 数据读取完毕，关闭连接</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    resieve.body += response; <span class="comment">// 拼接 body 部分</span></span><br><span class="line">    <span class="comment">// 后续传输</span></span><br><span class="line">    <span class="keyword">if</span> (isOver()) &#123;</span><br><span class="line">        socket.end();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">socket.write(<span class="string">`GET / HTTP/1.1</span></span><br><span class="line"><span class="string">Host: baidu.com</span></span><br><span class="line"><span class="string">Connection: keep-alive</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span>);</span><br><span class="line"></span><br><span class="line">socket.on(<span class="string">'close'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(resieve.body); <span class="comment">// 拿到响应体 html string</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"结束了"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建服务器</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">"net"</span>);</span><br><span class="line"><span class="comment">// 返回 server 对象</span></span><br><span class="line"><span class="keyword">const</span> server = net.createServer();</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">9999</span>); <span class="comment">// 监听9999端口</span></span><br><span class="line">server.on(<span class="string">'listening'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 监听开启便会触发</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"server listen 9999"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">server.on(<span class="string">'connection'</span>, socket =&gt; &#123;</span><br><span class="line">    <span class="comment">// 有客户端连接就触发</span></span><br><span class="line">    <span class="comment">// 每次连接都会产生一个 socket</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"customer connecting..."</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="http-模块（更常使用）"><a href="#http-模块（更常使用）" class="headerlink" title="http 模块（更常使用）"></a>http 模块（更常使用）</h2><p>http 模块建立在 net 模块之上，无需手动管理 socket；也无需手动组装消息格式。</p>
<ol>
<li><p>创建客户端（发送请求）</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client.js</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// http.request(url[, options][, callback]); // 发送请求，类似 ajax ，是更纯粹的 http 请求</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="string">"http://www.baidu.com"</span>;</span><br><span class="line"><span class="keyword">const</span> request = http.request(url,&#123; <span class="comment">/** 发送请求 */</span></span><br><span class="line">    method: <span class="string">"GET"</span></span><br><span class="line">    <span class="comment">// 若要发送 POST 请求，在外面利用返回的 request 对象去写数据即可</span></span><br><span class="line">    <span class="comment">// 如: request.write("username=ssk&amp;password=xxx");</span></span><br><span class="line">&#125;, resp =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"服务器响应状态码:"</span>, resp.statusCode);  <span class="comment">// 响应状态码</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"服务器响应头:"</span>, resp.headers); <span class="comment">// 响应头对象</span></span><br><span class="line">    <span class="comment">// 响应体需要以流的形式读取</span></span><br><span class="line">    <span class="keyword">let</span> result = <span class="string">""</span>;</span><br><span class="line">    resp.on(<span class="string">'data'</span>, chunk =&gt; &#123;</span><br><span class="line">        result += chunk.toString(<span class="string">'utf-8'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    resp.on(<span class="string">'end'</span>, chunk =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(result);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">request.end();  <span class="comment">// 发送消息体结束</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>搭建服务器</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>); <span class="comment">// url模块用来解析url</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理请求 —— 拿到请求的内容</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleRequest</span>(<span class="params">request</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> urlobj = url.parse(request.url);</span><br><span class="line">    <span class="keyword">let</span> body = <span class="string">""</span>; <span class="comment">// 可能请求的数据量很多, 流的方式读取</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'请求到来!'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'请求路径: '</span>, request.url);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"请求方法: "</span>, request.method);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'请求头: '</span>, request.headers);</span><br><span class="line">    request.on(<span class="string">'data'</span>, chunk =&gt; &#123;</span><br><span class="line">        body += chunk.toString(<span class="string">'utf-8'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    request.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'请求体: '</span>, body);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">    handleRequest(request);</span><br><span class="line">    response.setHeader(<span class="string">'a'</span>, <span class="string">'1'</span>);   <span class="comment">// 设置消息头</span></span><br><span class="line">    response.setHeader(<span class="string">'b'</span>, <span class="string">'2'</span>);</span><br><span class="line">    response.statusCode = <span class="number">404</span>;  <span class="comment">// 设置响应状态码</span></span><br><span class="line">    <span class="comment">// 若在 .write() 之后设置，则无效，因为write已经成功将数据传过去了，正常响应码自然是200</span></span><br><span class="line">    response.write(<span class="string">"你好"</span>);</span><br><span class="line">    response.end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">9999</span>); <span class="comment">// 监听 9999 号端口</span></span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'listening'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"server listening 9999"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>总结一下：</p>
<ul>
<li>客户端：<br>  发送的 <code>请求</code> 是 <code>ClientRequest</code> 对象；<br>  接收的 <code>响应</code> 是 <code>IncomingMessage</code> 对象。</li>
<li>我是服务器：<br>  接收的 <code>请求</code> 是 <code>IncomingMessage</code> 对象；<br>  发送的 <code>响应</code> 是 <code>ServerResponse</code> 对象。</li>
</ul>
</li>
</ol>
<p>练习一下：</p>
<p>静态资源服务器 (通过 <code>localhost:xxxx</code> 访问当前路径下的 public 文件夹下的静态文件资源):</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> URL = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getStat</span>(<span class="params">filename</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> fs.promises.stat(filename);   <span class="comment">// 文件存在</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;  <span class="comment">// 文件不存在</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getFileContent</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> urlObj = URL.parse(url);</span><br><span class="line">    <span class="keyword">let</span> filename = path.resolve(__dirname, <span class="string">"public"</span>, urlObj.pathname.substr(<span class="number">1</span>)),</span><br><span class="line">        stat = <span class="keyword">await</span> getStat(filename);</span><br><span class="line">    <span class="keyword">if</span> (!stat) &#123;</span><br><span class="line">        <span class="comment">// 当前访问的文件不存在</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (stat.isDirectory()) &#123;</span><br><span class="line">        <span class="comment">// 当前访问的是文件夹 -&gt; 进一步找它是否含有子文件 index.html (默认全都找此文件)</span></span><br><span class="line">        filename = path.resolve(__dirname, <span class="string">"public"</span>, urlObj.pathname.substr(<span class="number">1</span>), <span class="string">"index.html"</span>);</span><br><span class="line">        stat = <span class="keyword">await</span> getStat(filename);</span><br><span class="line">        <span class="keyword">if</span> (!stat) &#123; <span class="comment">// 无</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 有</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> fs.promises.readFile(filename);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 当前访问的文件存在 -&gt; 直接读取文件内容(这里因为知道都是小文件，所以没有使用流的方式读取)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> fs.promises.readFile(filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">handler</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> info = <span class="keyword">await</span> getFileContent(req.url);</span><br><span class="line">    <span class="keyword">if</span> (info) &#123;</span><br><span class="line">        res.write(info);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.statusCode = <span class="number">404</span>;</span><br><span class="line">        <span class="comment">// 未找到匹配的文件资源(你也可以写成一个html网页，会好看一点哈)</span></span><br><span class="line">        res.write(<span class="string">"Response is no exists..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    res.end();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(handler);</span><br><span class="line"></span><br><span class="line">server.on(<span class="string">'listening'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"server listing 9999..."</span>);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">9999</span>); <span class="comment">// 监听 9999 端口 (如若浏览器打开被拒绝，可能你的9999端口被占用了)</span></span><br></pre></td></tr></table></figure>

    </div>
    
    <div class="post-footer">
        <div>
            
            转载声明：
            商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">Snippet</a>
            
            
        </div>
        <div>
            
        </div>
    </div>
</article>
<div class="article-nav prev-next-wrap clearfix">
    
    
    <a href="/2020/05/22/NodeJs%E5%88%9D%E8%AF%86%20%E4%B9%8B%E4%B8%80/" class="next-post btn btn-default" title='NodeJs初识 之一'>
        <span class="hidden-lg">下一篇</span>
        <span class="hidden-xs">
            NodeJs初识 之一</span><i class="fa fa-angle-right fa-fw"></i>
    </a>
    
</div>

<div id="comments">
    

<div id="vcomments" class="valine"></div>

<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>

<script>
new Valine({
    av: AV,
    el: '#vcomments',
    appId: 'xOKV9J4UeQAtVkvnJC7Kq2Jn-gzGzoHsz',
    appKey: 'erIpQac4azoCmgfBB7Dl9maa',
    placeholder: '说点什么吧',
    notify: false,
    verify: true,
    avatar: 'mm',
    meta: 'nick,mail'.split(','),
    pageSize: '10',
    path: window.location.pathname,
    lang: 'en'.toLowerCase()
})
</script>


</div>

                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">
            Table of Contents
        </h3>
        
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#fs-文件流-amp-amp-net-模块-amp-amp-http-模块"><span class="toc-text">fs 文件流 &amp;&amp; net 模块 &amp;&amp; http 模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#流"><span class="toc-text">流</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#文件流"><span class="toc-text">文件流</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#net-模块"><span class="toc-text">net 模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#http-模块（更常使用）"><span class="toc-text">http 模块（更常使用）</span></a></li></ol></li></ol>
        
    </div>
</aside>
                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>
<a id="back-to-top" class="icon-btn hide">
    <i class="fa fa-chevron-up"></i>
</a>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
</div>
            </div>
            <div class="col-sm-12">
                <span>Copyright &copy;
                    2017
                    
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>




<script src="/js/app.js?rev=@@hash.js"></script>

</body>
</html>